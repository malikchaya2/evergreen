unset_function_vars: true

#######################################
#              Functions              #
#######################################
functions:
  test-vars:
    - command: shell.exec
      params:
        script: |
          echo "value of foo before expansion.update '${foo}'"
    - command: expansions.update
      params:
        key: foo
        value: "bar-update-from-func"
    - command: shell.exec
      params:
        script: |
          echo "value of foo after update '${foo}'"

#######################################
#                Tasks                #
#######################################

tasks:
  - name: chaya-funcs
    commands:
      - command: shell.exec
        params:
          script: echo value of foo before the function ran '${foo}'
      - func: test-vars
        vars:
          foo: "bar-function-var"
      - command: shell.exec
        params:
          script: echo value of foo after the function ran '${foo}'

#######################################
#            Buildvariants            #
#######################################
buildvariants:
  - name: lint
    display_name: Lint
    run_on:
      - ubuntu2204-small
      - ubuntu2204-large
    expansions:
      foo: "bar-function-bv"
      GOROOT: /opt/golang/go1.20
    tasks:
      - name: "chaya-funcs"
